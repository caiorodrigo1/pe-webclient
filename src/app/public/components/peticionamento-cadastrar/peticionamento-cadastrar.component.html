<main class="m-4">
  <div class="d-flex flex-column align-items-center">
    <h2 class="m-3">Cadastrar Peticionamento</h2>

    <div class="row">
      <div class="col-xl-12">
        <div class="card" style="max-width: 700px">
          <div class="card-header bg-primary p-1"></div>
          <div class="card-body">
            <form
              *ngIf="!finalizado"
              class="formulario"
              name="editform"
              role="form"
              novalidate
              [formGroup]="editForm"
            >
              <section class="row">
                <div class="col-md-12">
                  <label for="campo_cliente" class="label-campo"
                    ><strong>Cliente:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-dropdown
                      inputId="campo_cliente"
                      name="cliente"
                      formControlName="cliente"
                      [options]="listaClientes"
                      placeholder="Selecione o Cliente"
                      [filter]="true"
                      filterBy="nome"
                      filterPlaceholder="Procurar Cliente"
                      emptyFilterMessage="Nenhum resultado encontrado"
                      dataKey="id"
                      (ngModelChange)="onChangeCliente($event)"
                      [class.ng-invalid]="editForm.get('cliente')!.invalid"
                      [class.ng-dirty]="editForm.get('cliente')!.touched"
                    >
                      <ng-template let-item pTemplate="selectedItem">
                        {{ item.nome }}
                      </ng-template>
                      <ng-template let-item pTemplate="item">
                        {{ item.nome }}
                      </ng-template>
                    </p-dropdown>
                    <i
                      id="filtroIcone"
                      *ngIf="
                        (editForm.get('cliente')!.invalid ||
                          editForm.get('cliente')!.value?.valor === '') &&
                        editForm.get('cliente')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="(editForm.get('cliente')!.errors?.['required'] || editForm.get('cliente')!.value?.valor === '') && editForm.get('cliente')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                </div>
              </section>

              <section class="row">
                <div class="col-md-12">
                  <label for="campo_orgao" class="label-campo"
                    ><strong>Orgão:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-dropdown
                      inputId="campo_orgao"
                      name="orgao"
                      formControlName="orgao"
                      [options]="listaOrgaos"
                      placeholder="Selecione o Orgão"
                      [filter]="true"
                      filterBy="nome"
                      filterPlaceholder="Procurar orgão"
                      emptyFilterMessage="Nenhum resultado encontrado"
                      dataKey="id"
                      [class.ng-invalid]="
                        editForm.get('orgao')!.invalid ||
                        editForm.get('orgao')!.value?.valor === ''
                      "
                      [class.ng-dirty]="editForm.get('orgao')!.touched"
                    >
                      <ng-template let-item pTemplate="selectedItem">
                        {{ item.sigla }}
                      </ng-template>
                      <ng-template let-item pTemplate="item">
                        {{ item.sigla }}
                      </ng-template>
                    </p-dropdown>
                    <i
                      id="filtroIcone"
                      *ngIf="
                        (editForm.get('orgao')!.invalid ||
                          editForm.get('orgao')!.value?.valor === '') &&
                        editForm.get('orgao')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="(editForm.get('orgao')!.errors?.['required'] || editForm.get('orgao')!.value?.valor === '') && editForm.get('orgao')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                </div>
              </section>

              <section class="row">
                <div class="col-md-12">
                  <label for="campo_nome" class="label-campo">
                    <strong>Nome Completo:</strong>
                    <span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <input
                      pInputText
                      id="campo_nome"
                      formControlName="nome"
                      name="nome"
                      type="text"
                      maxlength="200"
                      class="p-inputtext-sm"
                      [class.ng-invalid]="editForm.get('nome')!.invalid"
                      [class.ng-dirty]="editForm.get('nome')!.touched"
                    />
                    <i
                      *ngIf="
                        editForm.get('nome')!.invalid &&
                        editForm.get('nome')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('nome')!.errors?.['required'] && editForm.get('nome')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('nome')!.errors?.['minlength'] && editForm.get('nome')!.touched"
                    class="p-error block"
                    >Este campo deve ter pelo menos 2 caracteres</small
                  >
                  <small
                    *ngIf="editForm.get('nome')!.errors?.['maxlength']"
                    class="p-error block"
                    >Este campo não pode ter mais de 50 caracteres.</small
                  >
                </div>
              </section>

              <section class="row">
                <div class="col-md-6">
                  <label for="campo_email" class="label-campo">
                    <strong>Email:</strong>
                  </label>
                  <div class="p-input-icon-right w-100">
                    <input
                      pInputText
                      id="campo_email"
                      name="email"
                      formControlName="email"
                      type="email"
                      placeholder="exemplo@email.com"
                      autocomplete="email"
                      maxlength="300"
                      class="p-inputtext-sm"
                      [class.ng-invalid]="editForm.get('email')!.invalid"
                      [class.ng-dirty]="editForm.get('email')!.touched"
                    />
                    <i
                      *ngIf="
                        editForm.get('email')!.invalid &&
                        editForm.get('email')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('email')!.errors?.['required'] && editForm.get('email')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('email')!.touched && editForm.get('email')!.errors?.['email']"
                    class="p-error block"
                    >O E-mail informado é inválido</small
                  >
                  <small
                    *ngIf="editForm.get('email')!.errors?.['minlength'] && editForm.get('email')!.touched"
                    class="p-error block"
                    >Este campo deve ter pelo menos 2 caracteres</small
                  >
                  <small
                    *ngIf="editForm.get('email')!.errors?.['maxlength']"
                    class="p-error block"
                    >Este campo não pode ter mais de 300 caracteres.</small
                  >
                </div>

                <div class="col-md-3">
                  <label for="campo_cpf" class="label-campo">
                    <strong>CPF:</strong>
                    <span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-inputMask
                      inputId="campo_cpf"
                      formControlName="cpf"
                      name="cpf"
                      mask="999.999.999-99"
                      [unmask]="true"
                      (ngModelChange)="testarValidadeCpf($event)"
                      [class.ng-invalid]="editForm.get('cpf')!.invalid"
                      [class.ng-dirty]="editForm.get('cpf')!.touched"
                    ></p-inputMask>
                    <i
                      *ngIf="
                        editForm.get('cpf')!.invalid &&
                        editForm.get('cpf')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('cpf')!.errors?.['required'] && editForm.get('cpf')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('cpf')!.invalid && editForm.get('cpf')!.touched && !editForm.get('cpf')!.errors?.['required']"
                    class="p-error block"
                    >O CPF informado é inválido</small
                  >
                </div>

                <div class="col-md-3">
                  <label for="campo_telefone" class="label-campo"
                    ><strong>Telefone:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-inputMask
                      inputId="campo_telefone"
                      name="telefone"
                      formControlName="telefone"
                      mask="(99) 99999-9999"
                      [unmask]="true"
                      [class.ng-invalid]="editForm.get('telefone')!.invalid"
                      [class.ng-dirty]="editForm.get('telefone')!.touched"
                    ></p-inputMask>
                    <i
                      *ngIf="
                        editForm.get('telefone')!.invalid &&
                        editForm.get('telefone')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('telefone')!.errors?.['required'] && editForm.get('telefone')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('telefone')!.invalid && editForm.get('telefone')!.touched
          && !editForm.get('telefone')!.errors?.['required']"
                    class="p-error block"
                    >O Telefone informado é inválido</small
                  >
                </div>
              </section>

              <section class="row">
                <div class="col-md-3">
                  <label for="campo_cep" class="label-campo"
                    ><strong>CEP:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-inputMask
                      inputId="campo_cep"
                      name="cep"
                      formControlName="cep"
                      mask="99.999-999"
                      [unmask]="true"
                      (onComplete)="testarCep()"
                      (onBlur)="testarCep()"
                      [class.ng-invalid]="editForm.get('cep')!.invalid"
                      [class.ng-dirty]="editForm.get('cep')!.touched"
                    ></p-inputMask>
                    <i
                      *ngIf="
                        editForm.get('cep')!.invalid &&
                        editForm.get('cep')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('cep')!.errors?.['invalido'] && editForm.get('cep')!.touched"
                    class="p-error block"
                    >O CEP digitado é inválido</small
                  >
                  <small
                    *ngIf="editForm.get('cep')!.errors?.['required'] && editForm.get('cep')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('cep')!.errors?.['minlength'] && editForm.get('cep')!.touched"
                    class="p-error block"
                    >Este campo deve ter pelo menos 8 caracteres</small
                  >
                  <small
                    *ngIf="editForm.get('cep')!.errors?.['maxlength']"
                    class="p-error block"
                    >Este campo não pode ter mais de 8 caracteres.</small
                  >
                </div>

                <div class="col-md-6">
                  <label for="campo_cidade" class="label-campo"
                    ><strong>Cidade:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <input
                      pInputText
                      id="campo_cidade"
                      name="cidade"
                      formControlName="cidade"
                      type="text"
                      maxlength="50"
                      class="p-inputtext-sm"
                      [class.ng-invalid]="editForm.get('cidade')!.invalid"
                      [class.ng-dirty]="editForm.get('cidade')!.touched"
                    />
                    <i
                      *ngIf="
                        editForm.get('cidade')!.invalid &&
                        editForm.get('cidade')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="editForm.get('cidade')!.errors?.['required'] && editForm.get('cidade')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                  <small
                    *ngIf="editForm.get('cidade')!.errors?.['minlength'] && editForm.get('cidade')!.touched"
                    class="p-error block"
                    >Este campo deve ter pelo menos 2 caracteres</small
                  >
                  <small
                    *ngIf="editForm.get('cidade')!.errors?.['maxlength']"
                    class="p-error block"
                    >Este campo não pode ter mais de 50 caracteres.</small
                  >
                </div>

                <div class="col-md-3">
                  <label for="campo_estado" class="label-campo"
                    ><strong>UF:</strong
                    ><span class="text-danger">*</span></label
                  >
                  <div class="p-input-icon-right w-100">
                    <p-dropdown
                      inputId="campo_estado"
                      name="estado"
                      formControlName="estado"
                      [options]="ufs"
                      placeholder="Selecione a UF"
                      [filter]="true"
                      filterBy="valor"
                      filterPlaceholder="Procurar UF"
                      emptyFilterMessage="Nenhum resultado encontrado"
                      dataKey="valor"
                      [class.ng-invalid]="
                        editForm.get('estado')!.invalid ||
                        editForm.get('estado')!.value?.valor === ''
                      "
                      [class.ng-dirty]="editForm.get('estado')!.touched"
                    >
                      <ng-template let-item pTemplate="selectedItem">
                        {{ item.valor }}
                      </ng-template>
                      <ng-template let-item pTemplate="item">
                        {{ item.valor }}
                      </ng-template>
                    </p-dropdown>
                    <i
                      id="filtroIcone"
                      *ngIf="
                        (editForm.get('estado')!.invalid ||
                          editForm.get('estado')!.value?.valor === '') &&
                        editForm.get('estado')!.touched
                      "
                      class="pi pi-exclamation-circle text-danger"
                    ></i>
                  </div>
                  <small
                    *ngIf="(editForm.get('estado')!.errors?.['required'] || editForm.get('estado')!.value?.valor === '') && editForm.get('estado')!.touched"
                    class="p-error block"
                    >Este campo é obrigatório</small
                  >
                </div>
              </section>

              <section class="row">
                <label for="campo_endereco" class="label-campo"
                  ><strong>Endereço:</strong
                  ><span class="text-danger">*</span></label
                >
                <div class="p-float-label p-input-icon-right col-md-12">
                  <textarea
                    pInputTextarea
                    id="campo_endereco"
                    name="endereco"
                    formControlName="endereco"
                    [autoResize]="true"
                    maxlength="400"
                    [class.ng-invalid]="editForm.get('endereco')!.invalid"
                    [class.ng-dirty]="editForm.get('endereco')!.touched"
                  ></textarea>
                  <i
                    id="areaTextoIcone"
                    *ngIf="
                      editForm.get('endereco')!.invalid &&
                      editForm.get('endereco')!.touched
                    "
                    class="pi pi-exclamation-circle text-danger"
                  ></i>
                </div>
                <small
                  *ngIf="editForm.get('endereco')!.errors?.['maxlength']"
                  class="p-error block"
                  >Este campo não pode ter mais de 400 caracteres.</small
                >
                <small
                  *ngIf="editForm.get('endereco')!.errors?.['required'] && editForm.get('endereco')!.touched"
                  class="p-error block"
                  >Este campo é obrigatório</small
                >
              </section>

              <section class="row">
                <label for="campo_solicitacao" class="label-campo"
                  ><strong>Solicitação:</strong
                  ><span class="text-danger">*</span></label
                >
                <div class="p-float-label p-input-icon-right col-md-12">
                  <textarea
                    pInputTextarea
                    id="campo_solicitacao"
                    name="solicitacao"
                    formControlName="solicitacao"
                    [autoResize]="true"
                    maxlength="400"
                    [class.ng-invalid]="editForm.get('solicitacao')!.invalid"
                    [class.ng-dirty]="editForm.get('solicitacao')!.touched"
                  ></textarea>
                  <i
                    id="areaTextoIcone"
                    *ngIf="
                      editForm.get('solicitacao')!.invalid &&
                      editForm.get('solicitacao')!.touched
                    "
                    class="pi pi-exclamation-circle text-danger"
                  ></i>
                </div>
                <small
                  *ngIf="editForm.get('solicitacao')!.errors?.['maxlength']"
                  class="p-error block"
                  >Este campo não pode ter mais de 400 caracteres.</small
                >
                <small
                  *ngIf="editForm.get('solicitacao')!.errors?.['required'] && editForm.get('solicitacao')!.touched"
                  class="p-error block"
                  >Este campo é obrigatório</small
                >
              </section>
            </form>

            <div *ngIf="finalizado" class="row">
              <div class="d-flex justify-content-center mt-2">
                <h3 style="color: #959a9d">
                  Peticionamento enviado com sucesso
                </h3>
              </div>
              <div class="d-flex justify-content-center mt-5">
                <strong>Número de protocolo gerado:</strong>
              </div>
              <div class="d-flex justify-content-center mt-2">
                <h2>{{ protocolo }}</h2>
              </div>
            </div>
          </div>

          <div class="card-footer bg-white text-end">
            <button
              id="bto-voltar"
              type="button"
              class="btn btn-white fa-lg me-2"
              routerLink="/login"
            >
              <i class="fa fa-arrow-left fa-lg me-2"></i>
              Voltar
            </button>
            <button
              *ngIf="!finalizado"
              id="bto-salvar"
              type="submit"
              (click)="salvar()"
              class="btn btn-primary me-2"
              [disabled]="salvando"
            >
              <i class="fa fa-save fa-lg me-2"></i>
              Salvar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
